<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Placar e Classifica√ß√£o</title>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

  <style>
    /* Estilos unificados do index.html e placar.html */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      background-color: #f4f8fb; /* Cor de fundo do index.html */
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* CABE√áALHO */
    header {
      background-color: #8fd2ff; /* Cor do header do index.html */
      color: #0055a5;
      padding: 20px 0;
      text-align: center;
    }
    
    /* MENU */
    .menu {
      list-style: none;
      display: flex;
      justify-content: center;
      background-color: #45a8e0;
      padding: 10px;
      border-radius: 8px;
      margin: 15px auto;
      max-width: 900px; /* Max-width do index.html */
      flex-wrap: wrap;
    }

    .menu li {
      margin: 8px 15px; /* Margin do index.html */
    }
    
    .menu a {
      color: white;
      text-decoration: none;
      font-weight: bold;
      padding: 10px 15px;
      border-radius: 4px;
      transition: background-color 0.3s, transform 0.2s;
    }

    .menu a:hover {
      background-color: #2c8ec6;
      transform: scale(1.05);
    }
    
    /* CONTE√öDO PRINCIPAL */
    main {
      padding: 30px 20px;
      max-width: 1000px; /* Ajustado para 1000px como no index.html */
      margin: auto;
      flex: 1;
      width: 100%;
    }

    /* SE√á√ÉO - NOVO ESTILO (Baseado em section do index.html) */
    .categoria-section, .stats-summary-wrapper {
      background-color: #ffffff; /* Cor de fundo do index.html */
      padding: 25px; /* Padding do index.html */
      margin-bottom: 30px; /* Margin do index.html */
      border-radius: 12px; /* Border-radius do index.html */
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); /* Sombra do index.html */
    }

    /* T√çTULOS - NOVO ESTILO (Baseado em h2 do index.html) */
    h1, h2, .categoria-title {
      color: #007acc; /* Cor do h2 do index.html */
      font-size: 1.8em; /* Font-size do h2 do index.html */
      border-bottom: 2px solid #d6ecf8; /* Borda do h2 do index.html */
      padding-bottom: 10px;
      margin-bottom: 20px;
      text-align: center; /* Mantido o centro para os t√≠tulos do placar */
    }

    .categoria-title {
      font-weight: 700;
      padding-bottom: 15px;
      border-bottom: 3px solid #4299e1; /* Ajuste para borda mais forte */
      position: relative;
    }

    .info-title h1 {
        border-bottom: none;
        margin-bottom: 0;
    }

    .info-title p {
        font-size: 1.1em;
        color: #444;
        line-height: 1.7;
        text-align: center;
        margin-top: 5px;
    }

    /* RODAP√â */
    footer {
      text-align: center;
      padding: 15px 15px; /* Padding do index.html */
      background-color: #8fd2ff; /* Cor do footer do index.html */
      color: #0055a5; /* Cor do texto do footer do index.html */
    }

    /* ESTAT√çSTICAS */
    .stats-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: #f4f8fb; /* Fundo leve para destaque */
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); /* Sombra mais leve */
      transition: transform 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-3px);
    }
    
    #pontuacao-resumo {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .stat-number {
      font-size: 2.5em;
      font-weight: bold;
      color: #007acc; /* Cor ajustada para o padr√£o do index.html */
    }
    .stat-label {
      color: #718096;
      font-weight: 500;
      margin-top: 5px;
    }

    /* TABELAS DE CLASSIFICA√á√ÉO */
    .table-container {
      overflow-x: auto;
      border-radius: 15px;
      box-shadow: 0 5px 25px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      min-width: 700px; 
      border-collapse: collapse;
      background: white;
      border-radius: 15px;
      overflow: hidden;
    }
    thead {
      background: linear-gradient(135deg, #007acc, #0055a5); /* Cores ajustadas para o padr√£o azul do index.html */
      color: white;
    }
    th {
      padding: 18px 12px;
      text-align: center;
      font-weight: 600;
      font-size: 0.95em;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }
    td {
      padding: 15px 12px;
      text-align: center;
      font-size: 0.9em;
      border-bottom: 1px solid #f1f5f9;
      transition: all 0.3s ease;
    }
    tr:nth-child(even) {
        background-color: #f8fcfd;
    }

    /* Ranking Colors */
    .rank-1 { background: linear-gradient(135deg, #ffd700, #ffe773) !important; font-weight: bold; color: #744210; }
    .rank-2 { background: linear-gradient(135deg, #c0c0c0, #d6d6d6) !important; font-weight: bold; color: #4a5568; }
    .rank-3 { background: linear-gradient(135deg, #cd7f32, #e59d4e) !important; font-weight: bold; color: #744210; }
    
    /* RESPONSIVIDADE (Conforme a requisi√ß√£o, a tabela n√£o muda o layout, apenas a rolagem) */ 
    @media (max-width: 600px) {
      .stats-summary, #pontuacao-resumo {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
¬†
<body>

  <header>
    <img src="logo.png" alt="Logo do Evento" width="400"/>
    <nav>
      <ul class="menu">
          <li><a href="index.html">P√°gina inicial</a></li>
        <li><a href="cronograma.html">Cronograma</a></li>
        <li><a href="placar.html">Placar</a></li>
        <li><a href="turmas.html">Turmas</a></li>
        <li><a href="galeria.html">Galeria</a></li>
        <li><a href="noticias.html">Not√≠cias</a></li>
        <li><a href="admin.html">Admin</a></li>
      </ul>
    </nav>
  </header>
¬† 
<main>
  <div class="stats-summary-wrapper">
    <div class="info-title">
      <h1>Placar e Classifica√ß√£o</h1>
      <p>Acompanhe em tempo real quem est√° na frente!</p>
    </div>

    <div style="padding: 0;">
      <h2 class="categoria-title" style="border-bottom: none; margin-bottom: 20px;">Estat√≠sticas Gerais</h2>
      <div class="stats-summary">
        <div class="stat-card">
          <div class="stat-number" id="totalJogos">0</div>
          <div class="stat-label">Total de Jogos</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="totalCartoes">0</div>
          <div class="stat-label">Total de Cart√µes</div>
        </div>
      </div>
      
      <div id="pontuacao-resumo">
        <div class="stat-card">
          <div class="stat-number" id="totalGols">0 ‚öΩ</div>
          <div class="stat-label">Total de Gols (Futsal)</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="totalCestas">0 üèÄ</div>
          <div class="stat-label">Total de Cestas (Basquete)</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="totalPontosVolei">0 üèê</div>
          <div class="stat-label">Total de Pontos (V√¥lei)</div>
        </div>
      </div>
    </div>
  </div>

  <div class="categoria-section">
    <h2 class="categoria-title">‚öΩ Futsal Fundamental I Masculino</h2>
    <div class="table-container">
      <table id="futsal-f1-masc">
        <thead>
          <tr>
            <th>Pos</th>
            <th>Time</th>
            <th>J</th>
            <th>V</th>
            <th>E</th>
            <th>D</th>
            <th>GF (Gols F.)</th>
            <th>GS (Gols S.)</th>
            <th>SG</th>
            <th>CA</th>
            <th>CV</th>
            <th>Pts</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="categoria-section">
    <h2 class="categoria-title">‚öΩ Futsal Fundamental II Masculino</h2>
    <div class="table-container">
      <table id="futsal-f2-masc">
        <thead>
          <tr>
            <th>Pos</th>
            <th>Time</th>
            <th>J</th>
            <th>V</th>
            <th>E</th>
            <th>D</th>
            <th>GF (Gols F.)</th>
            <th>GS (Gols S.)</th>
            <th>SG</th>
            <th>CA</th>
            <th>CV</th>
            <th>Pts</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="categoria-section">
    <h2 class="categoria-title">‚öΩ Futsal Fundamental Feminino</h2>
    <div class="table-container">
      <table id="futsal-fem">
        <thead>
          <tr>
            <th>Pos</th>
            <th>Time</th>
            <th>J</th>
            <th>V</th>
            <th>E</th>
            <th>D</th>
            <th>GF (Gols F.)</th>
            <th>GS (Gols S.)</th>
            <th>SG</th>
            <th>CA</th>
            <th>CV</th>
            <th>Pts</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="categoria-section">
    <h2 class="categoria-title">‚öΩ Futsal Ensino M√©dio Masculino</h2>
    <div class="table-container">
      <table id="futsal-medio-masc">
        <thead>
          <tr>
            <th>Pos</th>
            <th>Time</th>
            <th>J</th>
            <th>V</th>
            <th>E</th>
            <th>D</th>
            <th>GF (Gols F.)</th>
            <th>GS (Gols S.)</th>
            <th>SG</th>
            <th>CA</th>
            <th>CV</th>
            <th>Pts</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="categoria-section">
    <h2 class="categoria-title">‚öΩ Futsal Ensino M√©dio Feminino</h2>
    <div class="table-container">
      <table id="futsal-medio-fem">
        <thead>
          <tr>
            <th>Pos</th>
            <th>Time</th>
            <th>J</th>
            <th>V</th>
            <th>E</th>
            <th>D</th>
            <th>GF (Gols F.)</th>
            <th>GS (Gols S.)</th>
            <th>SG</th>
            <th>CA</th>
            <th>CV</th>
            <th>Pts</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="categoria-section">
    <h2 class="categoria-title">üèÄ Basquete Fundamental</h2>
    <div class="table-container">
      <table id="basquete-funda">
        <thead>
          <tr>
            <th>Pos</th>
            <th>Time</th>
            <th>J</th>
            <th>V</th>
            <th>E</th>
            <th>D</th>
            <th>CESTAS F.</th> 
            <th>CESTAS S.</th> 
            <th>SG</th>
            <th>CA</th>
            <th>CV</th>
            <th>Pts</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="categoria-section">
    <h2 class="categoria-title">üèÄ Basquete Ensino M√©dio</h2>
    <div class="table-container">
      <table id="basquete-medio">
        <thead>
          <tr>
            <th>Pos</th>
            <th>Time</th>
            <th>J</th>
            <th>V</th>
            <th>E</th>
            <th>D</th>
            <th>CESTAS F.</th> 
            <th>CESTAS S.</th> 
            <th>SG</th>
            <th>CA</th>
            <th>CV</th>
            <th>Pts</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="categoria-section">
    <h2 class="categoria-title">üèê V√¥lei Masculino</h2>
    <div class="table-container">
      <table id="volei-masc">
        <thead>
          <tr>
            <th>Pos</th>
            <th>Time</th>
            <th>J</th>
            <th>V</th>
            <th>E</th>
            <th>D</th>
            <th>PONTOS F.</th> 
            <th>PONTOS S.</th> 
            <th>SG</th>
            <th>CA</th>
            <th>CV</th>
            <th>Pts</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="categoria-section">
    <h2 class="categoria-title">üèê V√¥lei Feminino</h2>
    <div class="table-container">
      <table id="volei-fem">
        <thead>
          <tr>
            <th>Pos</th>
            <th>Time</th>
            <th>J</th>
            <th>V</th>
            <th>E</th>
            <th>D</th>
            <th>PONTOS F.</th> 
            <th>PONTOS S.</th> 
            <th>SG</th>
            <th>CA</th>
            <th>CV</th>
            <th>Pts</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</main>

  <footer>
    <p>&copy; 2025 Jogos Escolares - Desenvolvido por: Vit√≥ria Dias, Maria Eduarda e Victor</p>
    <p>Sistema otimizado para preenchimento online em tempo real</p>
  </footer>

  <script>
    // 1. CONFIGURA√á√ÉO E INICIALIZA√á√ÉO DO FIREBASE (CORRIGIDO)
    const firebaseConfig = {
    apiKey: "AIzaSyCRakqwGgSmxCSYH1MDxexhwQQYov3hJ-M",
    authDomain: "interclasse-4b24b.firebaseapp.com",
    projectId: "interclasse-4b24b",
    storageBucket: "interclasse-4b24b.firebasestorage.app",
    messagingSenderId: "730939186397",
    appId: "1:730939186397:web:c6b4ede1ab3a0f1a24cf34",
    measurementId: "G-PBB7FQHY6F"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
   
    // 2. VARI√ÅVEIS E CONFIGURA√á√ïES
    const STORAGE_KEY = 'jogos-ee_backup'; 
    const CONFIG = {
      REFRESH_INTERVAL: 30000 // 30 segundos
    };

    const TEAMS = {
      'futsal-f1-masc': ['6¬∫ Ano A', '6¬∫ Ano B', '7¬∫ Ano A', '7¬∫ Ano B'],
      'futsal-f2-masc': ['8¬∫ Ano A', '8¬∫ Ano B', '9¬∫ Ano A', '9¬∫ Ano B'],
      'futsal-fem': ['Feminino A F', 'Feminino B F'],
      'futsal-medio-masc': ['1¬∫ Ano EMTI', '2¬∫ Ano A', '2¬∫ Ano EMTI', '3¬∫ Ano EMTI'],
      'futsal-medio-fem': ['9¬∫ Ano B Fem', 'M√©dio Time A', 'M√©dio Time B'],
      'basquete-funda': ['Basquete F. A', 'Basquete F. B'],
      'basquete-medio': ['Basquete M. A', 'Basquete M. B'],
      'volei-masc': ['V√¥lei Masc. A', 'V√¥lei Masc. B'],
      'volei-fem': ['V√¥lei Fem. A', 'V√¥lei Fem. B']
    };
    
    let appState = {
      tableData: {},
      matchHistory: [], 
      lastUpdate: null
    };
    
    // =========================================================
    // === FUN√á√ïES DE C√ÅLCULO E INICIALIZA√á√ÉO ==================
    // =========================================================

    function initializeStandings() {
      Object.keys(TEAMS).forEach(category => {
        appState.tableData[category] = TEAMS[category].map(team => ({
          team: team, jogos: 0, vitorias: 0, empates: 0, derrotas: 0,
          golsFeitos: 0, golsSofridos: 0, amarelos: 0, vermelhos: 0,
          saldoGols: 0, pontos: 0
        }));
      });
    }
    
    function processMatchResult(match) {
      try {
        const categoria = match.categoria;
        const pontosA = parseInt(match.pontosA);
        const pontosB = parseInt(match.pontosB);

        if (!appState.tableData[categoria]) return;

        const teamA = appState.tableData[categoria].find(t => t.team === match.timeA);
        const teamB = appState.tableData[categoria].find(t => t.team === match.timeB);

        if (!teamA || !teamB) {
          console.warn(`Time n√£o encontrado em ${categoria}: ${match.timeA} ou ${match.timeB}. Ignorando partida.`);
          return; 
        }

        // A. Estat√≠sticas Comuns
        teamA.jogos += 1;
        teamB.jogos += 1;

        teamA.amarelos += parseInt(match.amarelosA) || 0;
        teamB.amarelos += parseInt(match.amarelosB) || 0;
        teamA.vermelhos += parseInt(match.vermelhosA) || 0;
        teamB.vermelhos += parseInt(match.vermelhosB) || 0;

        teamA.golsFeitos += pontosA;
        teamA.golsSofridos += pontosB;
        teamB.golsFeitos += pontosB;
        teamB.golsSofridos += pontosA;

        // B. Vit√≥rias, Empates, Derrotas e Pontos
        if (pontosA > pontosB) {
          teamA.vitorias += 1;
          teamB.derrotas += 1;
          teamA.pontos += 3; 
        } else if (pontosB > pontosA) {
          teamB.vitorias += 1;
          teamA.derrotas += 1;
          teamB.pontos += 3;
        } else {
          teamA.empates += 1;
          teamA.pontos += 1; 
          teamB.empates += 1;
          teamB.pontos += 1;
        }

        // C. Saldo de Gols
        teamA.saldoGols = teamA.golsFeitos - teamA.golsSofridos;
        teamB.saldoGols = teamB.golsFeitos - teamB.golsSofridos;

      } catch (e) {
        console.error("Erro ao processar o resultado da partida:", e, match);
      }
    }

    function calculateStandingsFromHistory() {
      initializeStandings(); 
      
      appState.matchHistory.forEach(match => {
        if (match && match.categoria && match.timeA && match.timeB) {
          processMatchResult(match);
        }
      });
    }
    
    // =========================================================
    // === FUN√á√ïES DE LEITURA FIREBASE E RENDERIZA√á√ÉO =========
    // =========================================================

    async function loadSavedData() {
      try {
        // 1. Leitura Ass√≠ncrona do Hist√≥rico de Partidas
        const snapshot = await db.collection("matchHistory").get();
        appState.matchHistory = snapshot.docs.map(doc => doc.data());

        // 2. Leitura Ass√≠ncrona do Status (para o timestamp)
        const statusDoc = await db.collection("status").doc("status-geral").get();
        if (statusDoc.exists) {
          appState.lastUpdate = statusDoc.data().lastUpdate || null;
        }
        
        console.log(`Dados do Firebase carregados. Partidas: ${appState.matchHistory.length}`);
        
      } catch (e) {
        console.error('Falha ao carregar dados do Firebase. Erro:', e.message);
        // Fallback para o caso de o Firebase falhar
        const localData = localStorage.getItem(STORAGE_KEY);
        if (localData) {
          const data = JSON.parse(localData);
          appState.matchHistory = data.matchHistory || [];
          appState.lastUpdate = data.lastUpdate;
          console.log('Usando dados locais como fallback.');
        } else {
          appState.matchHistory = [];
        }
      }
    }
    
    function updateTable(categoria) {
      const table = document.getElementById(categoria);
      const tbody = table.querySelector('tbody');

      if (!appState.tableData[categoria]) return; 

      const sortedTeams = [...appState.tableData[categoria]].sort((a, b) => {
        if (b.pontos !== a.pontos) return b.pontos - a.pontos;
        if (b.saldoGols !== a.saldoGols) return b.saldoGols - a.saldoGols;
        return b.golsFeitos - a.golsFeitos;
      });

      tbody.innerHTML = '';

      sortedTeams.forEach((team, index) => {
        const row = tbody.insertRow();
        
        let rankClass = '';
        if (index === 0) rankClass = 'rank-1';
        else if (index === 1) rankClass = 'rank-2';
        else if (index === 2) rankClass = 'rank-3';
        
        row.className = rankClass;

        let gfLabel = 'GF (Gols F.)';
        let gsLabel = 'GS (Gols S.)';
        if (categoria.includes('basquete')) {
          gfLabel = 'CESTAS F.';
          gsLabel = 'CESTAS S.';
        } else if (categoria.includes('volei')) {
          gfLabel = 'PONTOS F.';
          gsLabel = 'PONTOS S.';
        }

        row.innerHTML = `
          <td data-label="Pos">${index + 1}¬∫</td>
          <td data-label="Time">${team.team}</td>
          <td data-label="J">${team.jogos}</td>
          <td data-label="V">${team.vitorias}</td>
          <td data-label="E">${team.empates}</td>
          <td data-label="D">${team.derrotas}</td>
          <td data-label="${gfLabel}">${team.golsFeitos}</td>
          <td data-label="${gsLabel}">${team.golsSofridos}</td>
          <td data-label="SG">${team.saldoGols >= 0 ? '+' : ''}${team.saldoGols}</td>
          <td data-label="CA">${team.amarelos}</td>
          <td data-label="CV">${team.vermelhos}</td>
          <td data-label="Pts"><strong>${team.pontos}</strong></td>
        `;
      });
    }

    function updateAllTables() {
      Object.keys(appState.tableData).forEach(categoria => {
        updateTable(categoria);
      });
    }

    function updateStats() {
      let totalJogos = 0;
      let totalCartoes = 0;
      let totalGols = 0;
      let totalCestas = 0;
      let totalPontosVolei = 0;

      Object.keys(appState.tableData).forEach(categoria => {
        const categoryData = appState.tableData[categoria];
        let isFutsal = categoria.includes('futsal');
        let isBasquete = categoria.includes('basquete');
        let isVolei = categoria.includes('volei');

        categoryData.forEach(team => {
          totalJogos += team.jogos;
          totalCartoes += team.amarelos + team.vermelhos;
          
          if (isFutsal) {
            totalGols += team.golsFeitos;
          } else if (isBasquete) {
            totalCestas += team.golsFeitos;
          } else if (isVolei) {
            totalPontosVolei += team.golsFeitos;
          }
        });
      });

      totalJogos = Math.floor(totalJogos / 2);

      document.getElementById('totalJogos').textContent = totalJogos;
      document.getElementById('totalCartoes').textContent = totalCartoes;
      document.getElementById('totalGols').textContent = totalGols + ' ‚öΩ';
      document.getElementById('totalCestas').textContent = totalCestas + ' üèÄ';
      document.getElementById('totalPontosVolei').textContent = totalPontosVolei + ' üèê';
    }

    function startAutoRefresh() {
      // Usa o setInterval para for√ßar a leitura peri√≥dica do Firebase (a cada 30s)
      setInterval(updateView, CONFIG.REFRESH_INTERVAL);
    }
    
    // NOVO: Adiciona um listener para o evento Storage (melhor que setInterval)
    function setupStorageListener() {
      window.addEventListener('storage', function(e) {
        if (e.key === STORAGE_KEY && e.newValue) {
          console.log('Storage event detected. Forcing view update.');
          updateView(); 
        }
      });
    }
    
    async function updateView() {
      await loadSavedData();
      calculateStandingsFromHistory(); 
      updateAllTables(); 
      updateStats();
      
      if (appState.lastUpdate) {
        const footer = document.querySelector('footer');
        let lastUpdateText = footer.querySelector('.last-update');
        if (!lastUpdateText) {
          lastUpdateText = document.createElement('p');
          lastUpdateText.className = 'last-update';
          footer.appendChild(lastUpdateText);
        }
        lastUpdateText.textContent = `√öltima atualiza√ß√£o: ${appState.lastUpdate}`;
      }
    }

    function initApp() {
      initializeStandings(); 
      setupStorageListener();
      updateView();
      startAutoRefresh();
    }

    window.addEventListener('load', initApp);
  </script>
</body>

</html>
